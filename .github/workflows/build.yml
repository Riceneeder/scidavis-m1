name: Build macOS

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: macos-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      with:
          submodules: true

    - name: Set up Homebrew
      run: |
        brew update
        brew install qt qwt gsl muparser zlib python pyqt sip

    - name: Set up environment
      run: |
        export PATH="/usr/local/opt/qt/bin:$PATH"

    - name: Configure SciDAVis
      run: |
        qmake CONFIG+=osx_dist

    - name: Build SciDAVis
      run: |
        make qmake
        make

    - name: Create installable package
      run: |
        sh mkMacDist.sh
